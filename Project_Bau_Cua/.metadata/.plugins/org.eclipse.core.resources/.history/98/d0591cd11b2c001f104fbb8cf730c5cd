package controller;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.TableCell;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.stage.Stage;
import javafx.util.Callback;
import model.DiceHistory;

public class HistoryController {
    @FXML
    public TableView<DiceHistory> diceHistoryTable;
    @FXML
    public TableColumn<DiceHistory, String> timeDiceColumn;
    @FXML
    public TableColumn<DiceHistory, String> faceDice1Column;
    @FXML
    public TableColumn<DiceHistory, String> faceDice2Column;
    @FXML
    public TableColumn<DiceHistory, String> faceDice3Column;
    @FXML
    public TableColumn<DiceHistory, Integer> receiveMoneyColumn;
    
    @FXML
    public Button closeHistory;
    
    public ObservableList<DiceHistory> diceHistoryList = FXCollections.observableArrayList();
    
    @FXML
    public void initialize() {
    	setProperties();
    	centeredColumn();
    	
    	// Thêm dữ liệu mẫu
        diceHistoryList.add(new DiceHistory("10:00", "1", "3", "5", 100));
        diceHistoryList.add(new DiceHistory("10:05", "2", "4", "6", 200));
        diceHistoryList.add(new DiceHistory("10:10", "3", "2", "1", 150));
        
        // Đưa dữ liệu vào bảng
        diceHistoryTable.setItems(diceHistoryList);
    	
    }
    
    
    // Liên kết các cột với các thuộc tính của DiceHistory
    @FXML
    public void setProperties() {
    	timeDiceColumn.setCellValueFactory(new PropertyValueFactory<>("timeDice"));
        faceDice1Column.setCellValueFactory(new PropertyValueFactory<>("faceDice1"));
        faceDice2Column.setCellValueFactory(new PropertyValueFactory<>("faceDice2"));
        faceDice3Column.setCellValueFactory(new PropertyValueFactory<>("faceDice3"));
        receiveMoneyColumn.setCellValueFactory(new PropertyValueFactory<>("receiveMoney"));
    }
    
    //Căn giữa Text trong cột
    @FXML
    public void centeredColumn() {
    	centerAlignColumn(timeDiceColumn);
    	centerAlignColumn(faceDice1Column);
        centerAlignColumn(faceDice2Column);
        centerAlignColumn(faceDice3Column);
        centerAlignColumn(receiveMoneyColumn);
    }
    
    private <T> void centerAlignColumn(TableColumn<DiceHistory, T> column) {
        column.setCellFactory(new Callback<TableColumn<DiceHistory, T>, TableCell<DiceHistory, T>>() {
            public TableCell<DiceHistory, T> call(TableColumn<DiceHistory, T> param) {
                return new TableCell<DiceHistory, T>() {
                    @Override
                    protected void updateItem(T item, boolean empty) {
                        super.updateItem(item, empty);
                        if (item == null || empty) {
                            setText(null);
                            setGraphic(null);
                        } else {
                            setText(item.toString());
                            setGraphic(null);
                            setStyle("-fx-alignment: CENTER;");
                        }
                    }
                };
            }
        });
    }
    
    public void addDiceHistory(DiceHistory diceHistory) {
        diceHistoryList.add(diceHistory);
        diceHistoryTable.setItems(diceHistoryList);
    }
    @FXML
    public void closeHistoryAction() {
        // Lấy stage của nút "Đóng" (nút này được đặt trong cùng một scene với popup)
        Stage stage = (Stage) closeHistory.getScene().getWindow();
        stage.close();
    }
}
